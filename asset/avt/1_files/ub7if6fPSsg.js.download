;/*FB_PKG_DELIM*/

__d("LSHandleMediaReceiverFetchResult.nop",["FBLogger","I64","MAWBridgeFireAndForget","MAWImageUtils","MAWMediaDownloadStatus","MAWMediaReceiverFetchDoneCallbackMap","ReQL","WAHashUtils","WALongInt","cr:17326"],(function(a,b,c,d,e,f,g){"use strict";var h;a=async function(a,e,f,g,i,j,k,l,m,n,o,p){e=await d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.attachments).getKeyRange(g,i));if(e==null||e.receiverFetchId==null||e.receiverFetchId!==f){c("MAWMediaReceiverFetchDoneCallbackMap").has(i)&&b("cr:17326")==null?c("MAWMediaReceiverFetchDoneCallbackMap").get(i)==null?void 0:c("MAWMediaReceiverFetchDoneCallbackMap").get(i)("error"):await (b("cr:17326")==null?void 0:b("cr:17326").txnHandler(a,{details:"issue_receiver_fetch_task_callback",key:d("WAHashUtils").stringToPlaintextHash(i),status:c("MAWMediaDownloadStatus").MANUAL_RETRYABLE_FAILURE,type:"main"}));c("FBLogger")("messenger_web_media").mustfix("Not a receiver fetch attachment from LSHandleMediaReceiverFetchResult.nop");return}o=d("MAWImageUtils").boundHeightWidth((h||(h=d("I64"))).to_int32(n),h.to_int32(m),d("MAWImageUtils").STICKER_THUMBNAIL_MAX_SIZE);g=o.height;n=o.width;await a.attachments.put(babelHelpers.extends({},e,{accessibilitySummaryText:(m=p)!=null?m:void 0,hasMedia:!0,previewHeight:h.of_int32(g),previewUrl:j,previewUrlExpirationTimestampMs:k,previewUrlMimeType:l,previewWidth:h.of_int32(n)}));c("MAWMediaReceiverFetchDoneCallbackMap").has(i)&&b("cr:17326")==null?c("MAWMediaReceiverFetchDoneCallbackMap").get(i)==null?void 0:c("MAWMediaReceiverFetchDoneCallbackMap").get(i)("success"):await (b("cr:17326")==null?void 0:b("cr:17326").txnHandler(a,{details:"issue_receiver_fetch_task_callback",key:d("WAHashUtils").stringToPlaintextHash(i),status:c("MAWMediaDownloadStatus").SUCCESS,type:"main"}));try{o=(h||(h=d("I64"))).to_string(k);e=d("WALongInt").decimalStringToLongInt(o);d("MAWBridgeFireAndForget").fireAndForget("backend","updateReceiverFetchInfo",{accessibilitySummaryText:p,previewUrl:j,previewUrlExpirationTimestampMs:e,receiverFetchId:f})}catch(a){c("FBLogger")("messenger_web_media").mustfix("Failed to cast previewUrlExpirationTimestampMs to long int: %s",a)}};a.__nop_name__="LSHandleMediaReceiverFetchResult";g.default=a}),98);